{% extends 'base.html' %}

{% block title %}
  My Pools - Car Pool
{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="header d-flex justify-content-between align-items-center mb-4">
    <h2>My Pools</h2>
    <div>
      <a href="/add" class="btn btn-primary">Add New Pool</a>
      <a href="/joinPool" class="btn btn-success ms-2">Join Pool</a>
    </div>
  </div>

  <!-- Active Pools Section -->
  <div class="section mb-4">
    <h3>Active Pools</h3>
    {% if active_pools %}
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>From</th>
            <th>To</th>
            <th>Date</th>
            <th>Contact</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for pool in active_pools %}
          <tr>
            <td>{{ pool.fromCity }}</td>
            <td>{{ pool.toCity }}</td>
            <td>{{ pool.datePoint }}</td>
            <td>{{ pool.contactPoint }}</td>
            <td>{{ pool.status }}</td>
            <td>
              {% if pool.status == "Accepted By Driver" %}
              <a href="/payment?ride_id={{ pool.id }}" class="btn btn-primary btn-sm">Make Payment</a>
              {% else %}
              <button class="btn btn-secondary btn-sm" disabled>Pending</button>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="alert alert-info">No active pools found.</div>
    {% endif %}
  </div>

  <!-- Completed Pools Section -->
  <div class="section">
    <h3>Completed Pools</h3>
    {% if completed_pools %}
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>From</th>
            <th>To</th>
            <th>Date</th>
            <th>Driver</th>
            <th>Distance</th>
            <th>ETH Amount</th>
            <th>Payment Status</th>
          </tr>
        </thead>
        <tbody>
          {% for pool in completed_pools %}
          <tr>
            <td>{{ pool.fromCity }}</td>
            <td>{{ pool.toCity }}</td>
            <td>{{ pool.datePoint }}</td>
            <td>{{ pool.driver_name }}</td>
            <td>{{ pool.payment_details.distance|floatformat:2 }} km</td>
            <td>{{ pool.payment_details.amount|floatformat:8 }} ETH</td>
            <td>
              {% if pool.payment_details.status == 'Completed' %}
              <span class="badge bg-success">Paid</span>
              {% else %}
              <span class="badge bg-warning">Pending</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="alert alert-info">No completed pools found.</div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .section {
    background: #fff;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .section h3 {
    margin-bottom: 15px;
    color: #333;
  }
</style>
{% endblock %}
